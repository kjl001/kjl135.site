<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="description" content="Kevin Lee's CSE135 Site Dataviz">
	<meta name="author" content="Kevin Lee">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>KJL135 Site Dataviz</title>
	<link href="images/favicon.ico" rel="icon">

	<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
</head>

<body>
	<section id="line"></section>
	<section id="bar"></section>
	
	<script>
		/* Get cookie helper function from John S from Stack Overflow*/
		function getCookie(name) {
			function escape(s) { return s.replace(/([.*+?\^$(){}|\[\]\/\\])/g, '\\$1'); }
			var match = document.cookie.match(RegExp('(?:^|;\\s*)' + escape(name) + '=([^;]*)'));
			return match ? match[1] : null;
		}

		async function getLine(type, id) {
			const url = `https://kjl135.site/mysql/${type}/${id}`;
			const response = await fetch(url, {
				method: "GET"
			});

			if (response.ok) {
				let data = await response.json();
				
				let loadStarts = [];
				let loadEnds = [];
				let totalLoads = [];

				for (key in data) {
					loadStarts.push(data[key]["loadStart"]);
					loadEnds.push(data[key]["loadEnd"]);
					totalLoads.push(data[key]["totalLoad"]);
				}

				zingchart.render({
					id: "line",
					width: "100%",
					height: 400,
					data: {
						type: 'line',
						title: {
							text: "Line Chart"
						},
						series: [
							{
								values: loadStarts,
								text: "Load Start Time"
							},
							{
								values: loadEnds,
								text: "Load End Time"
							},
							{
								values: totalLoads,
								text: "Toal Load Duration"
							}
						]
					}
				});
			} else {
				console.log("GET LINE DATA ERROR");
			}
		}

		async function getBar(type, id) {
			const url = `https://kjl135.site/${type}/${id}`;
			const response = await fetch(url, {
				method: "GET"
			});

			if (response.ok) {
				let data = await response.json();

				let leftClicks = 0;
				let rightClicks = 0;

				for (key in data) {
					if (data[key]["clickButton"] == "0") {
						leftClicks++;
					}
					else if (data[key]["clickButton"] == "2") {
						rightClicks++;
					}
				}

				zingchart.render({
					id: "bar",
					width: "100%",
					height: 400,
					data: {
						type: "bar",
						title: {
							text: "Bar Chart"
						},
						"scale-x": {
							labels: ["Left Clicks", "Right Clicks"]
						},
						series: [
							{
								values: [leftClicks, rightClicks]
							}
						]
					}
				});
			} else {
				console.log("GET BAR DATA ERROR");
			}
		}

		window.addEventListener('load', async function () {
			const cookie = getCookie("pvisitor");
			getLine("performance", cookie);
			getBar("activity", cookie);

		});
	</script>
</body>
</html>